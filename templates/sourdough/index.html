{% extends "sourdough/base.html" %}

{% load static %}

{% block head %}
<link rel="stylesheet" type="text/css" href="{% static 'sourdough/app.css' %}">
<link rel="stylesheet" type="text/css" href="{% static 'sourdough/index.css' %}">

{% endblock %}

{% block content %}
<section class="jumbotron">
    <div class="container">
        <img src="https://img.icons8.com/bubbles/100/000000/kawaii-bread-1.png"/>
        <h1>Bread calculator</h1>
        <p class="lead text-muted">
            Calculate ingredients for your sourdough bread with baker's percentage.
        </p>
    </div>
</section>

<div class="py-5 calculator-light">
    <div class="container">
        <div id="root"></div>
    </div>
</div>

<div class="save-section py-5">
    <div class="container">
        <div class="row">
            <div class="col-sm">
                <p><strong>Awesome recipe? Save it!</strong></p>
                <label for="nameInput">Name:</label>
                <div class="input-group mb-3">
                    <input type="text" class="form-control" id="nameInput">
                </div>
                <button type="button" class="btn btn-primary saveButton">Save recipe</button>
            </div>
        </div>
    </div>
</div>

{% endblock %}

{% block scripts %}
<script>
    $(function () {
        console.log('ready');
        $('.saveButton').click(function () {
            console.log('click');
            const data = {
                'flour': 123
            };

            const name = $('#nameInput').val();
            console.log(name);
            const encodedName = encodeURIComponent(name);
            console.log(encodedName);

            const d = $('#calculatorForm').serialize() + '&name=' + encodedName;
            console.log(d);

            $.ajax({
                url: "/save",
                type: "POST",
                data: d,

                success: function (response) {
                    console.log('oko');
                    console.log(response.result);
                    console.log(response.url);
                    window.location.href = response.url; //relative to domain
                },
                error: function (response) {
                    console.log('err');
                    console.log(response);
                }
            });
        });
    });
</script>
<script src="{% static 'sourdough/app.js' %}"></script>
{% endblock %}